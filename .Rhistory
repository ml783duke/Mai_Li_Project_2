knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(tidyverse)
library(lubridate)
clean_aq <- function(path) {
raw <- read_csv(path, show_col_types = FALSE)
cleaned <- raw %>%
# Rename pollutant columns to short names
rename(
co   = `Daily Max 8-hour CO Concentration`,
pm25 = `Daily Mean PM2.5 Concentration`,
o3   = `Daily Max 8-hour Ozone Concentration`
) %>%
# Convert date to Date class
mutate(
date = as.Date(Date, format = "%m/%d/%Y")
) %>%
# Keep only the variables we need
select(date, co, pm25, o3) %>%
# Aggregate to daily means when there are multiple records per day
group_by(date) %>%
summarise(
co   = mean(co,   na.rm = TRUE),
pm25 = mean(pm25, na.rm = TRUE),
o3   = mean(o3,   na.rm = TRUE),
.groups = "drop"
) %>%
# Treat negative values as measurement error: truncate at 0
mutate(
co   = pmax(co,   0),
pm25 = pmax(pm25, 0),
o3   = pmax(o3,   0)
) %>%
# Final de-duplication (safety check)
distinct()
cleaned
}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(tidyverse)
library(lubridate)
aq2018 <- clean_aq("AQ_2018.csv") %>% mutate(year = 2018)
aq2018 <- clean_aq(here::here("AQ_2018.csv")) %>% mutate(year = 2018)
library(here)
clean_aq <- function(path) {
raw <- read_csv(path, show_col_types = FALSE)
cleaned <- raw %>%
rename(
co   = `Daily Max 8-hour CO Concentration`,
pm25 = `Daily Mean PM2.5 Concentration`,
o3   = `Daily Max 8-hour Ozone Concentration`
) %>%
mutate(
date = as.Date(Date, format = "%m/%d/%Y")
) %>%
select(date, co, pm25, o3) %>%
group_by(date) %>%
summarise(
co   = mean(co,   na.rm = TRUE),
pm25 = mean(pm25, na.rm = TRUE),
o3   = mean(o3,   na.rm = TRUE),
.groups = "drop"
) %>%
mutate(
co   = pmax(co,   0),
pm25 = pmax(pm25, 0),
o3   = pmax(o3,   0)
) %>%
distinct()
cleaned
}
aq2018 <- clean_aq(here::here("AQ_2018.csv")) %>% mutate(year = 2018)
aq2018 <- clean_aq(here::here("data", "AQ_2018.csv")) %>% mutate(year = 2018)
aq2019 <- clean_aq(here::here("AQ_2019.csv")) %>% mutate(year = 2019)
aq2018 <- clean_aq(here::here("data", "AQ_2018.csv")) %>% mutate(year = 2018)
aq2019 <- clean_aq(here::here("data","AQ_2019.csv")) %>% mutate(year = 2019)
aq2020 <- clean_aq(here::here("data","AQ_2020.csv")) %>% mutate(year = 2020)
aq_all <- bind_rows(aq2018, aq2019, aq2020) %>%
mutate(
month = month(date)
)
head(aq_all)
co_o3_monthly <- aq_all %>%
group_by(month) %>%
summarise(
mean_co = mean(co, na.rm = TRUE),
sd_co   = sd(co,   na.rm = TRUE),
n_co    = sum(!is.na(co)),
mean_o3 = mean(o3, na.rm = TRUE),
sd_o3   = sd(o3,   na.rm = TRUE),
n_o3    = sum(!is.na(o3)),
.groups = "drop"
) %>%
mutate(
se_co  = sd_co / sqrt(n_co),
lwr_co = mean_co - 1.96 * se_co,
upr_co = mean_co + 1.96 * se_co,
se_o3  = sd_o3 / sqrt(n_o3),
lwr_o3 = mean_o3 - 1.96 * se_o3,
upr_o3 = mean_o3 + 1.96 * se_o3
)
co_long <- co_o3_monthly %>%
transmute(
month,
pollutant = "CO",
mean = mean_co,
lwr  = lwr_co,
upr  = upr_co
)
o3_long <- co_o3_monthly %>%
transmute(
month,
pollutant = "O3",
mean = mean_o3,
lwr  = lwr_o3,
upr  = upr_o3
)
plot1_data <- bind_rows(co_long, o3_long)
ggplot(plot1_data, aes(x = month, y = mean, color = pollutant)) +
geom_line() +
geom_point() +
geom_errorbar(aes(ymin = lwr, ymax = upr), width = 0.2) +
labs(
title = "Monthly mean CO and O3 concentrations (2018–2020 combined)",
subtitle = "Points show monthly means; error bars show 95% confidence intervals",
x = "Month",
y = "Average concentration",
color = "Pollutant"
) +
theme_minimal()
install.packages("bootstrap")
library(bootstrap)
library(boot)
library(dplyr)
set.seed(1)
# Simulation settings
dists <- c("norm", "exp")
stats <- c("mean", "median")
n_list <- c(10, 50, 100)
R_boot <- 1000
R_sim  <- 1000
results <- data.frame()
# Statistic function for boot()
boot_stat_fun <- function(data, indices, stat = c("mean", "median")) {
d <- data[indices]
if (stat == "mean")   return(mean(d))
if (stat == "median") return(median(d))
}
# True values
true_value_fun <- function(dist, stat) {
if (stat == "mean") {
if (dist == "norm") return(0) else return(1)
} else {
if (dist == "norm") return(0) else return(log(2))
}
}
# Main simulation loop
for (dist in dists) {
for (n in n_list) {
for (stat in stats) {
true_val <- true_value_fun(dist, stat)
# containers
jack_Est <- c(); jack_SE <- c()
jack_CIl <- c(); jack_CIu <- c()
jack_Time <- c()
boot_Est <- c(); boot_SE <- c()
boot_CIl <- c(); boot_CIu <- c()
boot_Time <- c()
for (sim in 1:R_sim) {
# Generate sample
x <- if (dist == "norm") rnorm(n) else rexp(n)
# ----------------- Jackknife() -----------------
jack_fun <- function(data, i) {
if (stat == "mean")   return(mean(data[i]))
if (stat == "median") return(median(data[i]))
}
t_jack <- system.time({
jack_res <- jackknife(x, jack_fun)
# jackknife estimate = mean of jackknife replicates
est_jack <- mean(jack_res$jack.values)
# jackknife standard error
se_jack <- sqrt((n - 1) / n * sum((jack_res$jack.values - est_jack)^2))
# 95% CI (normal approximation)
ci_lower <- est_jack - 1.96 * se_jack
ci_upper <- est_jack + 1.96 * se_jack
})[3]
jack_Est  <- c(jack_Est, est_jack)
jack_SE   <- c(jack_SE, se_jack)
jack_CIl  <- c(jack_CIl, ci_lower)
jack_CIu  <- c(jack_CIu, ci_upper)
jack_Time <- c(jack_Time, t_jack)
# ----------------- Bootstrap() -----------------
t_boot <- system.time({
boot_res <- boot(
data = x,
statistic = function(d, idx) boot_stat_fun(d, idx, stat),
R = R_boot
)
est_boot <- mean(boot_res$t)
se_boot  <- sd(boot_res$t)
# 95% percentile CI
ci_boot <- quantile(boot_res$t, c(0.025, 0.975))
})[3]
boot_Est  <- c(boot_Est, est_boot)
boot_SE   <- c(boot_SE, se_boot)
boot_CIl  <- c(boot_CIl, ci_boot[1])
boot_CIu  <- c(boot_CIu, ci_boot[2])
boot_Time <- c(boot_Time, t_boot)
}
# Save summary
results <- rbind(
results,
data.frame(
dist = dist,
stat = stat,
n = n,
jack_bias = mean(jack_Est - true_val),
jack_se   = mean(jack_SE),
jack_ci_lower = mean(jack_CIl),
jack_ci_upper = mean(jack_CIu),
jack_time = mean(jack_Time),
boot_bias = mean(boot_Est - true_val),
boot_se   = mean(boot_SE),
boot_ci_lower = mean(boot_CIl),
boot_ci_upper = mean(boot_CIu),
boot_time = mean(boot_Time)
)
)
}
}
}
print(results)
write.csv(results, "jack_boot_results.csv", row.names = FALSE)
getwd()
View(aq2018)
clean_aq <- function(path) {
raw <- read_csv(path, show_col_types = FALSE)
cleaned <- raw %>%
rename(
co   = `Daily Max 8-hour CO Concentration`,
pm25 = `Daily Mean PM2.5 Concentration`,
o3   = `Daily Max 8-hour Ozone Concentration`
) %>%
mutate(
date = as.Date(Date, format = "%m/%d/%Y")
) %>%
select(date, co, pm25, o3) %>%
group_by(date) %>%
summarise(
co   = mean(co,   na.rm = TRUE),
pm25 = mean(pm25, na.rm = TRUE),
o3   = mean(o3,   na.rm = TRUE),
.groups = "drop"
) %>%
mutate(
co   = pmax(co,   0),
pm25 = pmax(pm25, 0),
o3   = pmax(o3,   0)
) %>%
distinct()
cleaned
}
aq2018 <- clean_aq(here::here("data", "AQ_2018.csv")) %>% mutate(year = 2018)
aq2019 <- clean_aq(here::here("data","AQ_2019.csv")) %>% mutate(year = 2019)
aq2020 <- clean_aq(here::here("data","AQ_2020.csv")) %>% mutate(year = 2020)
aq_all <- bind_rows(aq2018, aq2019, aq2020) %>%
mutate(
month = month(date)
)
head(aq_all)
co_o3_monthly <- aq_all %>%
group_by(month) %>%
summarise(
mean_co = mean(co, na.rm = TRUE),
sd_co   = sd(co,   na.rm = TRUE),
n_co    = sum(!is.na(co)),
mean_o3 = mean(o3, na.rm = TRUE),
sd_o3   = sd(o3,   na.rm = TRUE),
n_o3    = sum(!is.na(o3)),
.groups = "drop"
) %>%
mutate(
se_co  = sd_co / sqrt(n_co),
lwr_co = mean_co - 1.96 * se_co,
upr_co = mean_co + 1.96 * se_co,
se_o3  = sd_o3 / sqrt(n_o3),
lwr_o3 = mean_o3 - 1.96 * se_o3,
upr_o3 = mean_o3 + 1.96 * se_o3
)
co_long <- co_o3_monthly %>%
transmute(
month,
pollutant = "CO",
mean = mean_co,
lwr  = lwr_co,
upr  = upr_co
)
o3_long <- co_o3_monthly %>%
transmute(
month,
pollutant = "O3",
mean = mean_o3,
lwr  = lwr_o3,
upr  = upr_o3
)
plot1_data <- bind_rows(co_long, o3_long)
ggplot(plot1_data, aes(x = month, y = mean, color = pollutant)) +
geom_line() +
geom_point() +
geom_errorbar(aes(ymin = lwr, ymax = upr), width = 0.2) +
labs(
title = "Monthly mean CO and O3 concentrations (2018–2020 combined)",
subtitle = "Points show monthly means; error bars show 95% confidence intervals",
x = "Month",
y = "Average concentration",
color = "Pollutant"
) +
theme_minimal()
pm25_monthly <- aq_all %>%
group_by(year, month) %>%
summarise(
mean_pm25 = mean(pm25, na.rm = TRUE),
.groups = "drop"
)
head(pm25_monthly)
ggplot(pm25_monthly, aes(x = month, y = mean_pm25, color = factor(year))) +
geom_line() +
geom_point() +
labs(
title = "Monthly PM2.5 trends by year",
x = "Month",
y = "Average PM2.5 concentration",
color = "Year"
) +
theme_minimal()
pm25_monthly <- aq_all %>%
group_by(year, month) %>%
summarise(
mean_pm25 = mean(pm25, na.rm = TRUE),
.groups = "drop"
)
head(pm25_monthly)
cd git@github.com:ml783duke/Mai_Li_Project_2.git
# Set global knitr chunk options:
# - echo = FALSE   → do not show R code in the final document
# - message = FALSE → suppress package and other messages
# - warning = FALSE → suppress warnings in the output
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
# Load tidyverse for data manipulation, wrangling, and plotting
library(tidyverse)
# Load lubridate for convenient date-time parsing and handling
library(lubridate)
# Load here to build file paths relative to the project root
# (avoids hard-coding absolute paths)
library(here)
