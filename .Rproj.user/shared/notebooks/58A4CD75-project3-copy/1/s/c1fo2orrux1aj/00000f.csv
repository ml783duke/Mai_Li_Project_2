"0","# Main simulation loop"
"0","for (dist in dists) {"
"0","  for (n in n_list) {"
"0","    for (stat in stats) {"
"0",""
"0","      true_val <- true_value_fun(dist, stat)"
"0",""
"0","      # containers"
"0","      jack_Est <- c(); jack_SE <- c()"
"0","      jack_CIl <- c(); jack_CIu <- c()"
"0","      jack_Time <- c()"
"0",""
"0","      boot_Est <- c(); boot_SE <- c()"
"0","      boot_CIl <- c(); boot_CIu <- c()"
"0","      boot_Time <- c()"
"0",""
"0","      for (sim in 1:R_sim) {"
"0",""
"0","        # Generate sample"
"0","        x <- if (dist == ""norm"") rnorm(n) else rexp(n)"
"0",""
"0","        # ----------------- Jackknife() -----------------"
"0","        jack_fun <- function(data, i) {"
"0","          if (stat == ""mean"")   return(mean(data[i]))"
"0","          if (stat == ""median"") return(median(data[i]))"
"0","        }"
"0",""
"0","        t_jack <- system.time({"
"0","          jack_res <- jackknife(x, jack_fun)"
"0",""
"0","          # jackknife estimate = mean of jackknife replicates"
"0","          est_jack <- mean(jack_res$jack.values)"
"0",""
"0","          # jackknife standard error"
"0","          se_jack <- sqrt((n - 1) / n * sum((jack_res$jack.values - est_jack)^2))"
"0",""
"0","          # 95% CI (normal approximation)"
"0","          ci_lower <- est_jack - 1.96 * se_jack"
"0","          ci_upper <- est_jack + 1.96 * se_jack"
"0","        })[3]"
"0",""
"0","        jack_Est  <- c(jack_Est, est_jack)"
"0","        jack_SE   <- c(jack_SE, se_jack)"
"0","        jack_CIl  <- c(jack_CIl, ci_lower)"
"0","        jack_CIu  <- c(jack_CIu, ci_upper)"
"0","        jack_Time <- c(jack_Time, t_jack)"
"0",""
"0","        # ----------------- Bootstrap() -----------------"
"0","        t_boot <- system.time({"
"0","          boot_res <- boot("
"0","            data = x,"
"0","            statistic = function(d, idx) boot_stat_fun(d, idx, stat),"
"0","            R = R_boot"
"0","          )"
"0",""
"0","          est_boot <- mean(boot_res$t)"
"0","          se_boot  <- sd(boot_res$t)"
"0",""
"0","          # 95% percentile CI"
"0","          ci_boot <- quantile(boot_res$t, c(0.025, 0.975))"
"0","        })[3]"
"0",""
"0","        boot_Est  <- c(boot_Est, est_boot)"
"0","        boot_SE   <- c(boot_SE, se_boot)"
"0","        boot_CIl  <- c(boot_CIl, ci_boot[1])"
"0","        boot_CIu  <- c(boot_CIu, ci_boot[2])"
"0","        boot_Time <- c(boot_Time, t_boot)"
"0","      }"
"0",""
"0","      # Save summary"
"0","      results <- rbind("
"0","        results,"
"0","        data.frame("
"0","          dist = dist,"
"0","          stat = stat,"
"0","          n = n,"
"0",""
"0","          jack_bias = mean(jack_Est - true_val),"
"0","          jack_se   = mean(jack_SE),"
"0","          jack_ci_lower = mean(jack_CIl),"
"0","          jack_ci_upper = mean(jack_CIu),"
"0","          jack_time = mean(jack_Time),"
"0",""
"0","          boot_bias = mean(boot_Est - true_val),"
"0","          boot_se   = mean(boot_SE),"
"0","          boot_ci_lower = mean(boot_CIl),"
"0","          boot_ci_upper = mean(boot_CIu),"
"0","          boot_time = mean(boot_Time)"
"0","        )"
"0","      )"
"0","    }"
"0","  }"
"0","}"
"0",""
"0","print(results)"
